#!/bin/sh

source inst/service/dbus-paths

function subst {
  pushd $1 > /dev/null
    cat $2 |
    sed "s @BUS_NAME@ $BUS_NAME g" |
    sed "s @R_LIBRARY_DIR@ ${R_LIBRARY_DIR#"$BUILD_DIR"} g" > $3
  popd > /dev/null
}

if [ -z "$DATA_DIR" ] || [ -z "$SYSCONF_DIR" ]; then
  echo "Warning: DATA_DIR and SYSCONF_DIR required to install the D-BUS service"
else
  mkdir -p $DATA_DIR/dbus-1/system-services
  mkdir -p $SYSCONF_DIR/dbus-1/system.d
  subst inst/service dbus.service.in $DATA_DIR/dbus-1/system-services/$BUS_NAME.service
  subst inst/service dbus.conf.in $SYSCONF_DIR/dbus-1/system.d/$BUS_NAME.conf
fi
